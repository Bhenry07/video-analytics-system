<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Video Analytics - AI Detection System</title>
    <link href="/node_modules/video.js/dist/video-js.css" rel="stylesheet" />
    <link rel="stylesheet" href="styles.css?v=7" />
  </head>
  <body>
    <div class="container">
      <header>
        <h1>ğŸ¥ Video Analytics System</h1>
        <p>AI-Powered Object Detection & Analytics</p>
      </header>

      <div class="main-content">
        <!-- Left Sidebar - Controls -->
        <aside class="sidebar">
          <div class="upload-section">
            <h3>ğŸ“ Upload Video</h3>
            <input type="file" id="videoUpload" accept="video/*" class="file-input" />
            <button id="uploadBtn" class="btn btn-primary">Upload</button>
            <p class="upload-note">Maximum file size: 5GB</p>
            <div id="uploadProgress" class="progress-bar hidden">
              <div class="progress-fill"></div>
            </div>
          </div>

          <div class="videos-list">
            <h3>ğŸ“¹ Recent Videos</h3>
            <div id="videosList"></div>
          </div>

          <div class="frame-extraction">
            <h3>ğŸ¬ Frame Extraction Tool</h3>
            <p class="section-note">Extract frames for training data</p>
            
            <div class="extraction-controls">
              <div class="extraction-setting-card">
                <div class="setting-header">
                  <span class="setting-icon">âš¡</span>
                  <label class="setting-label">Extraction Rate: <span id="extractionFpsValue" class="setting-value">0.5</span> fps</label>
                </div>
                <input type="range" id="extractionFps" min="0.1" max="5" step="0.1" value="0.5" class="extraction-slider" />
                <p class="control-hint">ğŸ“ <span id="extractionHint">1 frame every 2 seconds</span></p>
              </div>

              <div class="extraction-setting-card">
                <div class="setting-header">
                  <span class="setting-icon">ğŸ¨</span>
                  <label class="setting-label">Image Quality: <span id="extractionQualityValue" class="setting-value">95</span>%</label>
                </div>
                <input type="range" id="extractionQuality" min="50" max="100" step="5" value="95" class="extraction-slider" />
                <p class="control-hint">ğŸ’ Higher quality = larger file sizes</p>
              </div>

              <div class="extraction-options">
                <div class="option-card">
                  <label class="checkbox-label-enhanced">
                    <input type="checkbox" id="skipSimilarFrames" />
                    <span class="checkbox-custom"></span>
                    <div class="option-info">
                      <span class="option-title">ğŸ”„ Skip Similar Frames</span>
                      <span class="option-description">Skip frames that are 98.5%+ identical (good for static scenes)</span>
                    </div>
                  </label>
                </div>

                <div class="option-card">
                  <label class="checkbox-label-enhanced">
                    <input type="checkbox" id="autoOrganize" checked />
                    <span class="checkbox-custom"></span>
                    <div class="option-info">
                      <span class="option-title">ğŸ“ Auto-Organize by Time Period</span>
                      <span class="option-description">Group frames by morning, midday, afternoon, evening, night</span>
                    </div>
                  </label>
                </div>
              </div>

              <div class="extraction-buttons">
                <button id="extractFramesBtn" class="btn btn-primary" disabled>
                  ğŸ¬ Extract Frames
                </button>
                <button id="previewFramesBtn" class="btn btn-secondary" disabled>
                  ğŸ‘ï¸ Preview
                </button>
              </div>

              <div id="extractionProgress" class="extraction-progress hidden">
                <div class="progress-info">
                  <span id="extractionStatus">Extracting...</span>
                  <span id="extractionCount">0 / 0</span>
                </div>
                <div class="progress-bar">
                  <div class="progress-fill" id="extractionProgressFill"></div>
                </div>
              </div>

              <div id="extractionStats" class="extraction-stats hidden">
                <h4>Extraction Complete!</h4>
                <p>Frames Extracted: <strong id="statsExtracted">0</strong></p>
                <p>Frames Skipped: <strong id="statsSkipped">0</strong></p>
                <p>Duration: <strong id="statsDuration">0s</strong></p>
                <div class="export-buttons">
                  <button id="exportAllFrames" class="btn btn-small">
                    ğŸ’¾ Download All Frames
                  </button>
                  <button id="exportManifest" class="btn btn-small">
                    ğŸ“‹ Download Manifest
                  </button>
                  <button id="viewFrames" class="btn btn-small">
                    ğŸ‘ï¸ View Frames
                  </button>
                </div>
              </div>
            </div>
          </div>

          <!-- Auto-Labeling & Training Section -->
          <div class="auto-labeling-section" id="labelingSection" style="display: block;">
            <h3>ğŸ¯ Label Training Data</h3>
            <p class="section-note">Auto-label frames and refine for model training</p>
            
            <!-- Class Setup -->
            <div class="class-setup-card">
              <h4>ğŸ“‹ Banking Classes</h4>
              <div class="classes-display">
                <div class="class-badge">ğŸ‘” bank-teller</div>
                <div class="class-badge">ğŸ¦ teller-station</div>
                <div class="class-badge">ğŸ§‘â€ğŸ’¼ customer-at-teller</div>
                <div class="class-badge">ğŸ’³ customer-at-atm</div>
                <div class="class-badge">ğŸ§ atm-machine</div>
              </div>
            </div>
            
            <!-- Auto-Label Controls -->
            <div class="auto-label-controls">
              <button id="autoLabelAllBtn" class="btn btn-primary">
                âš¡ Auto-Label All Frames
              </button>
              <button id="reviewLabelsBtn" class="btn btn-secondary">
                ğŸ‘€ Review Labels
              </button>
              <button id="exportDatasetBtn" class="btn btn-success">
                ğŸ“¦ Export Dataset
              </button>
            </div>
            
            <!-- Progress -->
            <div id="autoLabelProgress" class="extraction-progress hidden">
              <div class="progress-info">
                <span id="autoLabelStatus">Processing...</span>
                <span id="autoLabelCount">0 / 0</span>
              </div>
              <div class="progress-bar">
                <div class="progress-fill" id="autoLabelProgressBar"></div>
              </div>
            </div>
            
            <!-- Stats -->
            <div id="autoLabelStats" class="labeling-stats-grid hidden">
              <div class="stat-card-small">
                <div class="stat-label-small">Total Frames</div>
                <div class="stat-value-small" id="statTotalFrames">0</div>
              </div>
              <div class="stat-card-small">
                <div class="stat-label-small">Labeled</div>
                <div class="stat-value-small" id="statLabeledFrames">0</div>
              </div>
              <div class="stat-card-small">
                <div class="stat-label-small">Auto</div>
                <div class="stat-value-small" id="statAutoLabels">0</div>
              </div>
              <div class="stat-card-small">
                <div class="stat-label-small">Manual</div>
                <div class="stat-value-small" id="statManualLabels">0</div>
              </div>
            </div>
          </div>

          <div class="detection-config">
            <h3>âš™ï¸ Detection Settings</h3>

            <div class="model-selector">
              <label>ğŸ¤– Detection Model:</label>
              <select id="modelSelector" class="model-select">
                <option value="coco-ssd">COCO-SSD (Generic)</option>
                <option value="yolov8-custom">YOLOv8 (Custom Banking Model)</option>
              </select>
              <div id="modelStatus" class="model-status">Loading...</div>
            </div>

            <label class="checkbox-label">
              <input type="checkbox" id="detectPeople" checked />
              <span>ğŸ‘¤ Detect People</span>
            </label>

            <label class="checkbox-label">
              <input type="checkbox" id="detectVehicles" checked />
              <span>ğŸš— Detect Vehicles</span>
            </label>

            <label class="checkbox-label">
              <input type="checkbox" id="detectAnimals" />
              <span>ğŸ• Detect Animals</span>
            </label>

            <label class="checkbox-label">
              <input type="checkbox" id="detectSports" />
              <span>âš½ Detect Sports Equipment</span>
            </label>

            <label class="checkbox-label">
              <input type="checkbox" id="detectFurniture" />
              <span>ğŸª‘ Detect Furniture</span>
            </label>

            <label class="checkbox-label">
              <input type="checkbox" id="detectPaymentSystems" />
              <span>ğŸ’³ Detect POS/ATM Systems</span>
            </label>

            <label class="checkbox-label">
              <input type="checkbox" id="detectObjects" checked />
              <span>ğŸ“¦ Detect Objects</span>
            </label>

            <div class="slider-control">
              <label>Confidence Threshold: <span id="confidenceValue">50</span>%</label>
              <input type="range" id="confidenceThreshold" min="0" max="100" value="50" />
            </div>

            <div class="slider-control">
              <label>Detection FPS: <span id="fpsValue">5</span></label>
              <input type="range" id="detectionFPS" min="1" max="30" value="5" />
            </div>

            <div class="profile-controls">
              <h4>ğŸ“‹ Detection Profiles</h4>
              <select id="profileSelect" class="profile-select">
                <option value="">-- Select Profile --</option>
                <option value="traffic">ğŸš¦ Traffic Monitoring</option>
                <option value="wildlife">ğŸ¦ Wildlife Detection</option>
                <option value="indoor">ğŸ  Indoor Surveillance</option>
                <option value="sports">âš½ Sports Analysis</option>
                <option value="custom">ğŸ’¾ Custom Profiles...</option>
              </select>
              <div class="profile-buttons">
                <button id="saveProfile" class="btn btn-small">ğŸ’¾ Save</button>
                <button id="loadProfile" class="btn btn-small">ğŸ“‚ Load</button>
                <button id="deleteProfile" class="btn btn-small">ğŸ—‘ï¸ Delete</button>
              </div>
            </div>

            <button id="startAnalysis" class="btn btn-success" disabled>â–¶ Start Analysis</button>
            <button id="stopAnalysis" class="btn btn-danger hidden">â¹ Stop Analysis</button>
            <button id="exportData" class="btn btn-secondary" disabled>ğŸ’¾ Export Data</button>
          </div>

          <div class="roi-controls">
            <h3>ğŸ¯ Regions of Interest (ROI)</h3>
            
            <div class="roi-mode">
              <label class="checkbox-label">
                <input type="checkbox" id="drawingMode" />
                <span>âœï¸ Drawing Mode</span>
              </label>
            </div>

            <div class="roi-shape-select">
              <label>Shape Type:</label>
              <select id="shapeType" class="shape-select">
                <option value="rectangle">ğŸ“ Rectangle</option>
                <option value="polygon">â¬¡ Polygon</option>
              </select>
            </div>

            <div class="roi-buttons">
              <button id="completePolygon" class="btn btn-small" disabled>âœ“ Complete Polygon</button>
              <button id="clearZones" class="btn btn-small">ğŸ—‘ï¸ Clear All Zones</button>
            </div>

            <div class="zones-list">
              <h4>Active Zones</h4>
              <div id="zonesList" class="zones-list-content">
                <p class="empty-message">No zones defined. Enable drawing mode and draw on the video.</p>
              </div>
            </div>

            <div class="zone-actions">
              <button id="exportZones" class="btn btn-small" disabled>ğŸ“¤ Export Zones</button>
              <button id="importZones" class="btn btn-small">ğŸ“¥ Import Zones</button>
            </div>
          </div>

          <div class="heatmap-controls">
            <h3>ğŸ”¥ Heat Map</h3>
            
            <div class="heatmap-toggle">
              <label class="checkbox-label">
                <input type="checkbox" id="heatmapEnabled" />
                <span>Show Heat Map</span>
              </label>
            </div>

            <div class="heatmap-settings">
              <div class="slider-control">
                <label for="heatmapIntensity">Intensity:</label>
                <input type="range" id="heatmapIntensity" min="0" max="200" value="100" step="10" />
                <span id="intensityValue">1.0</span>
              </div>

              <div class="slider-control">
                <label for="heatmapOpacity">Opacity:</label>
                <input type="range" id="heatmapOpacity" min="0" max="100" value="50" step="5" />
                <span id="opacityValue">50%</span>
              </div>

              <div class="color-scheme-select">
                <label for="heatmapColorScheme">Color Scheme:</label>
                <select id="heatmapColorScheme" class="color-scheme">
                  <option value="hot">ğŸ”¥ Hot</option>
                  <option value="cool">â„ï¸ Cool</option>
                  <option value="rainbow">ğŸŒˆ Rainbow</option>
                </select>
              </div>
            </div>

            <div class="heatmap-actions">
              <button id="clearHeatmap" class="btn btn-small">ğŸ—‘ï¸ Clear</button>
              <button id="exportHeatmap" class="btn btn-small" disabled>ğŸ“· Export</button>
            </div>
          </div>

          <div class="model-status">
            <h3>ğŸ¤– Model Status</h3>
            <div id="modelStatus" class="status-indicator">
              <span class="status-dot loading"></span>
              <span class="status-text">Loading AI Model...</span>
            </div>
          </div>
        </aside>

        <!-- Main Video Area -->
        <main class="video-section">
          <div class="video-container">
            <div id="videoPlaceholder" class="video-placeholder">
              <div class="placeholder-content">
                <div class="placeholder-icon">ğŸ¬</div>
                <h3>No Video Loaded</h3>
                <p>Upload a video or select one from "Recent Videos" to begin analysis</p>
              </div>
            </div>
            <video
              id="videoPlayer"
              class="video-js vjs-default-skin vjs-big-play-centered"
              controls
              preload="auto"
              width="960"
              height="540"
              style="display: none"
            ></video>
            <canvas id="heatmapCanvas"></canvas>
            <canvas id="detectionCanvas"></canvas>
          </div>

          <div class="analytics-section">
            <div class="stats-grid">
              <div class="stat-card">
                <div class="stat-icon">ğŸ‘¤</div>
                <div class="stat-content">
                  <div class="stat-value" id="peopleCount">0</div>
                  <div class="stat-label">People Detected</div>
                </div>
              </div>

              <div class="stat-card">
                <div class="stat-icon">ğŸš—</div>
                <div class="stat-content">
                  <div class="stat-value" id="vehicleCount">0</div>
                  <div class="stat-label">Vehicles Detected</div>
                </div>
              </div>

              <div class="stat-card">
                <div class="stat-icon">ğŸ•</div>
                <div class="stat-content">
                  <div class="stat-value" id="animalCount">0</div>
                  <div class="stat-label">Animals Detected</div>
                </div>
              </div>

              <div class="stat-card">
                <div class="stat-icon">âš½</div>
                <div class="stat-content">
                  <div class="stat-value" id="sportsCount">0</div>
                  <div class="stat-label">Sports Equipment</div>
                </div>
              </div>

              <div class="stat-card">
                <div class="stat-icon">ğŸª‘</div>
                <div class="stat-content">
                  <div class="stat-value" id="furnitureCount">0</div>
                  <div class="stat-label">Furniture Detected</div>
                </div>
              </div>

              <div class="stat-card">
                <div class="stat-icon">ï¿½</div>
                <div class="stat-content">
                  <div class="stat-value" id="paymentSystemCount">0</div>
                  <div class="stat-label">POS/ATM Detected</div>
                </div>
              </div>

              <div class="stat-card">
                <div class="stat-icon">ï¿½ğŸ“¦</div>
                <div class="stat-content">
                  <div class="stat-value" id="objectCount">0</div>
                  <div class="stat-label">Total Objects</div>
                </div>
              </div>

              <div class="stat-card">
                <div class="stat-icon">âš¡</div>
                <div class="stat-content">
                  <div class="stat-value" id="processingFPS">0</div>
                  <div class="stat-label">Processing FPS</div>
                </div>
              </div>
            </div>

            <div class="chart-container">
              <h3>ğŸ“Š Detection Timeline</h3>
              <canvas id="timelineChart"></canvas>
            </div>

            <div class="detections-log">
              <h3>ğŸ“‹ Detection Log</h3>
              <div id="detectionLog" class="log-content"></div>
            </div>
          </div>
          
          <!-- Labeling Interface Container -->
          <div id="labelingInterfaceContainer" style="display: none; margin-top: 20px;"></div>
        </main>
      </div>
    </div>

    <script src="/node_modules/@tensorflow/tfjs/dist/tf.min.js"></script>
    <script src="/node_modules/@tensorflow-models/coco-ssd/dist/coco-ssd.min.js"></script>
    <script src="/node_modules/video.js/dist/video.min.js"></script>
    <script src="/node_modules/chart.js/dist/chart.umd.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/onnxruntime-web@1.17.0/dist/ort.min.js"></script>

    <!-- Load modules -->
    <script src="modules/error-handler.js"></script>
    <script src="modules/profile-manager.js"></script>
    <script src="modules/roi-manager.js"></script>
    <script src="modules/heat-map.js"></script>
    <script src="modules/frame-extractor.js"></script>
    <script src="modules/auto-labeling-engine.js"></script>
    <script src="modules/labeling-interface.js"></script>
    <script src="modules/yolov8-engine.js"></script>
    <script src="modules/detection-engine.js"></script>
    <script src="modules/chart-manager.js"></script>
    <script src="modules/data-exporter.js"></script>
    <script src="modules/ui-controller.js"></script>

    <!-- Load main application (use app-refactored.js for new modular version) -->
    <script src="app-refactored.js"></script>
  </body>
</html>
